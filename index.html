<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DeepSeek API 代理</title>
    <script>
        // 安全提示：此Key仅用于前端演示。生产环境应使用后端代理进一步保护密钥。
        const API_KEY = 'sk-dc6bef73a14048ad8ae87a214c2ae0c9';
        const API_URL = 'https://api.deepseek.com/v1/chat/completions';

        // 监听来自永洪BI父窗口的消息
        window.addEventListener('message', async function(event) {
            // 为安全起见，可在此处检查event.origin是否为您的永洪BI域名
            if (event.data && event.data.action === 'askDeepSeek') {
                const question = event.data.question;
                const answer = await callDeepSeekAPI(question);
                // 将结果发送回永洪BI父窗口
                window.parent.postMessage({
                    action: 'deepseekAnswer',
                    answer: answer
                }, '*'); // 生产环境建议指定具体origin，如 event.origin
            }
        });

        // 调用DeepSeek API的核心函数
        async function callDeepSeekAPI(question) {
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{ role: 'user', content: question }],
                        max_tokens: 2000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`API错误: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;

            } catch (error) {
                console.error('API调用失败:', error);
                return `抱歉，查询失败: ${error.message}`;
            }
        }

        // 可选：通知父页面已准备就绪
        window.parent.postMessage({ action: 'proxyReady' }, '*');
    </script>
</head>
<body style="margin:0; padding:0; background:transparent;">
    <!-- 页面无需可见内容 -->
</body>
</html>
